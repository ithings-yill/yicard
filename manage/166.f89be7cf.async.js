(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[166],{zIjg:function(e,t,a){"use strict";var n=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("J+/v");var l=n(a("MoRW"));a("IzEo");var r=n(a("bx4M"));a("Znn+");var o=n(a("ZTPi"));a("+L6B");var u=n(a("2/Rp"));a("7Kak");var c=n(a("9yH6"));a("5Dmo");var d=n(a("3S7+"));a("bP8k");var i=n(a("gFTJ"));a("Mwp2");var f=n(a("VXEj"));a("Telt");var p=n(a("Tckk"));a("Pwec");var s=n(a("CtXQ"));a("miYZ");var m=n(a("tsqr")),y=n(a("2Taf")),v=n(a("vZ4D")),g=n(a("MhPg")),E=n(a("l4Ni")),h=n(a("ujKo")),b=n(a("p0pE"));a("y8nQ");var x=n(a("Vl3Y"));a("2qtc");var P,C,k,S,w=n(a("kLXV")),I=q(a("q1tI")),T=a("MuoO"),O=n(a("ZhIB")),M=n(a("wd/R")),F=n(a("HZnN")),z=n(a("zHco")),D=n(a("ufQ4"));function j(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(j=function(e){return e?a:t})(e)}function q(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var a=j(t);if(a&&a.has(e))return a.get(e);var n={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var o=l?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}return n.default=e,a&&a.set(e,n),n}function R(e){var t=Y();return function(){var a,n=(0,h.default)(e);if(t){var l=(0,h.default)(this).constructor;a=Reflect.construct(n,arguments,l)}else a=n.apply(this,arguments);return(0,E.default)(this,a)}}function Y(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z=w.default.confirm,W=(P=x.default.create(),C=(0,T.connect)(function(e){var t=e.platformproduct,a=e.loading;return(0,b.default)({},t,{loading:a.effects["platformproduct/page"]})}),k=F.default.Secured("/platformservice/product"),(0,D.default)(S=P(S=C(S=k(S=function(e){(0,g.default)(a,e);var t=R(a);function a(){var e;(0,y.default)(this,a);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return e=t.call.apply(t,[this].concat(l)),e.state={pageSize:12,currentProduct:null,qty:1,capacityExpansion:0,transactionPrice:0,payment:0},e.loadTenant=function(){var t=e.props.dispatch;t({type:"platformproduct/getTenant"})},e.loadProduct=function(){var t=e.props.dispatch;t({type:"platformproduct/getProduct"})},e.toOrder=function(t){e.setState({currentProduct:t},function(){e.calcuPayment()})},e.handleStandardTableChange=function(t){var a=e.props.dispatch,n=e.state.pageSize,l={pageIndex:t-1,pageSize:n};a({type:"platformproduct/page",payload:l})},e.onChange=function(t){e.setState({qty:t.target.value})},e.onCapacityExpansionChange=function(t){e.setState({capacityExpansion:t.target.value},function(){e.calcuPayment()})},e.onSubmit=function(){var t=e.props.dispatch,a=e.state,n=a.currentProduct,l=a.qty,r=a.capacityExpansion;n||m.default.error("\u8bf7\u9009\u62e9\u5546\u54c1"),Z({okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u8ba2\u8d2d".concat(n.name,"?"),onOk:function(){t({type:"platformproduct/toOrder",payload:{product:n.id,qty:l,capacityExpansion:r}})}})},e.calcuPayment=function(){var t=e.state,a=t.currentProduct,n=t.qty,l=t.capacityExpansion;if(a){var r=e.props,o=r.tenantInfo,u=r.prevProduct,c=(0,M.default)(o.endDate).diff((0,M.default)().format("YYYY-MM-DD"),"days")+1;if(1===l){var d=u?u.price*n/365*c:0,i=a?a.price*n/365*c-d:0;i=i>0?i:0,e.setState({transactionPrice:i,payment:i})}else{var f=0;if(o.deliveryCapacity<a.capacity&&c>0&&u){var p=u?u.price*n/365*c:0;f=a.price*n/365*c-p,f=f>0?f:0}e.setState({transactionPrice:f+a.price*n,payment:f})}}},e}return(0,v.default)(a,[{key:"componentDidMount",value:function(){var e=this.props.currentUser,t=e&&e.entCode&&4===e.entCode.length;t&&(this.loadTenant(),this.loadProduct());var a=this.state.pageSize,n=this.props.dispatch;n({type:"platformproduct/page",payload:{pageIndex:0,pageSize:a}})}},{key:"render",value:function(){var e,t,a,n,m=this,y=this.props,v=y.pageData,g=y.loading,E=y.submitting,h=y.currentUser,x=y.tenantInfo,P=y.prevProduct,C=this.state,k=C.currentProduct,S=C.capacityExpansion,w=C.transactionPrice,T=C.payment,M={};v&&(M=v);var F=h&&h.entCode&&h.entCode.length<=4,D=h&&h.entCode&&4===h.entCode.length,j=(null===(e=M)||void 0===e?void 0:null===(t=e.pagination)||void 0===t?void 0:t.total)>12&&(0,b.default)({},M.pagination,{onChange:function(e){m.handleStandardTableChange(e)}});return I.default.createElement(z.default,null,F?I.default.createElement(r.default,null,I.default.createElement(o.default,{defaultActiveKey:"1",style:{minHeight:"380px",paddingTop:"10px"}},I.default.createElement(o.default.TabPane,{tab:"\u670d\u52a1\u5546\u54c1",key:"1"},I.default.createElement(f.default,{loading:g,grid:{gutter:16,column:4},dataSource:M.list,pagination:j,renderItem:function(e){return I.default.createElement(f.default.Item,{onClick:function(){return m.toOrder(e)},key:e.title,style:{border:"1px solid #E8E8E8",borderRadius:8,backgroundColor:(null===k||void 0===k?void 0:k.id)===e.id?"#F7F3DE":"#E7FAFF",boxShadow:"6px 6px 3px #888888",padding:15,width:160,height:100}},I.default.createElement(f.default.Item.Meta,{avatar:I.default.createElement(p.default,{style:{backgroundColor:"#87d068"},icon:I.default.createElement(s.default,{type:"hdd",theme:"filled"})}),title:"\u51fa\u5e93\u5bb9\u91cf",description:I.default.createElement("span",{style:{color:"green",fontSize:14,fontWeight:"bold"}},(e.capacity/1e4).toFixed(0),"\u4e07/",e.unitTxt)}),I.default.createElement("span",{style:{color:"red"}},"\u5355\u4ef7\uff1a","\xa5 ".concat((0,O.default)(e.price).format("0,0.00"))))}}),D&&I.default.createElement("div",{style:{background:"#FFF0F0",boxShadow:"6px 6px 3px #888888",padding:20}},I.default.createElement(i.default,{size:"small",column:4},I.default.createElement(i.default.Item,{label:"\u5f53\u524d\u5bb9\u91cf"},(null===x||void 0===x?void 0:x.deliveryCapacity)?"".concat((x.deliveryCapacity/1e4).toFixed(0),"\u4e07/\u5e74"):"--"),I.default.createElement(i.default.Item,{label:"\u5f53\u524d\u5269\u4f59"},null!==(a=null===x||void 0===x?void 0:x.leftDelivery)&&void 0!==a?a:"--"),I.default.createElement(i.default.Item,{label:"\u5f53\u524d\u670d\u52a1"},null!==(n=null===x||void 0===x?void 0:x.date)&&void 0!==n?n:"--")),I.default.createElement(i.default,{size:"small",column:4},I.default.createElement(i.default.Item,{label:"\u9009\u8d2d\u5bb9\u91cf"},I.default.createElement("span",{style:{color:"red"}},(null===k||void 0===k?void 0:k.capacity)?"".concat((k.capacity/1e4).toFixed(0),"\u4e07/").concat(k.unitTxt):"--")),I.default.createElement(i.default.Item,{label:""},I.default.createElement(c.default.Group,{value:S,onChange:this.onCapacityExpansionChange},I.default.createElement(c.default,{value:0},I.default.createElement("span",null,"\u7eed\u8d39\xa0",I.default.createElement(d.default,{title:"\u5ef6\u957f\u670d\u52a1\u671f\uff0c\u9009\u62e9\u5927\u4e8e\u73b0\u6709\u5bb9\u91cf\u4e14\u8fd8\u5728\u670d\u52a1\u671f\u5219\u9700\u8981\u8865\u7f34\u6269\u5bb9\u8d39\u7528"},I.default.createElement(s.default,{type:"question-circle-o"})))),P&&I.default.createElement(c.default,{value:1},I.default.createElement("span",null,"\u6269\u5bb9\xa0",I.default.createElement(d.default,{title:"\u589e\u52a0\u51fa\u5e93\u5bb9\u91cf\uff0c\u9700\u8865\u7f34\u6269\u5bb9\u8d39\u7528"},I.default.createElement(s.default,{type:"question-circle-o"})))))),I.default.createElement(i.default.Item,{label:"\u8d39\u7528"},I.default.createElement("span",{style:{color:"red"}},"\uffe5".concat((0,O.default)(w).format("0,0.00"))),I.default.createElement("span",{style:{color:"green"}},T>0?"\uff08\u8865\u7f34\uff1a\uffe5".concat((0,O.default)(T).format("0,0.00"),"\uff09"):"")),I.default.createElement(i.default.Item,{label:""},I.default.createElement(u.default,{type:"primary",style:{marginRight:30,marginLeft:30},disabled:!k,loading:E,onClick:this.onSubmit},"\u7acb\u5373\u8d2d\u4e70"))))))):I.default.createElement(l.default,{status:"403",title:"403",subTitle:"\u62b1\u6b49\uff0c\u975e\u5361\u5546\u7ba1\u7406\u5458\uff0c\u4f60\u65e0\u6743\u8bbf\u95ee\u8be5\u9875\u9762"}))}}]),a}(I.PureComponent))||S)||S)||S)||S),B=W;t.default=B}}]);