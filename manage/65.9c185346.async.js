(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[65],{zIjg:function(e,t,a){"use strict";var l=a("TqRt"),n=a("284h");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("J+/v");var r=l(a("MoRW"));a("IzEo");var d=l(a("bx4M"));a("Znn+");var o=l(a("ZTPi"));a("+L6B");var c=l(a("2/Rp"));a("7Kak");var u=l(a("9yH6"));a("5Dmo");var i=l(a("3S7+"));a("bP8k");var p=l(a("gFTJ"));a("Mwp2");var f=l(a("VXEj"));a("Telt");var s=l(a("Tckk"));a("Pwec");var m=l(a("CtXQ"));a("miYZ");var v=l(a("tsqr")),y=l(a("lwsE")),g=l(a("W8MJ")),E=l(a("a1gu")),h=l(a("Nsbk")),b=l(a("7W2i")),x=l(a("MVZn"));a("y8nQ");var C=l(a("Vl3Y"));a("2qtc");var P,S,k,I,T,w=l(a("kLXV")),F=n(a("q1tI")),q=a("MuoO"),z=l(a("ZhIB")),M=l(a("wd/R")),D=l(a("HZnN")),O=l(a("zHco")),R=l(a("ufQ4")),Y=w.default.confirm,Z=(P=C.default.create(),S=(0,q.connect)(function(e){var t=e.platformproduct,a=e.loading;return(0,x.default)({},t,{loading:a.effects["platformproduct/page"]})}),k=D.default.Secured("/platformservice/product"),(0,R.default)(I=P(I=S(I=k((T=function(e){function t(){var e,a;(0,y.default)(this,t);for(var l=arguments.length,n=new Array(l),r=0;r<l;r++)n[r]=arguments[r];return a=(0,E.default)(this,(e=(0,h.default)(t)).call.apply(e,[this].concat(n))),a.state={pageSize:12,currentProduct:null,qty:1,capacityExpansion:0,transactionPrice:0,payment:0},a.loadTenant=function(){var e=a.props.dispatch;e({type:"platformproduct/getTenant"})},a.loadProduct=function(){var e=a.props.dispatch;e({type:"platformproduct/getProduct"})},a.toOrder=function(e){a.setState({currentProduct:e},function(){a.calcuPayment()})},a.handleStandardTableChange=function(e){var t=a.props.dispatch,l=a.state.pageSize,n={pageIndex:e-1,pageSize:l};t({type:"platformproduct/page",payload:n})},a.onChange=function(e){a.setState({qty:e.target.value})},a.onCapacityExpansionChange=function(e){a.setState({capacityExpansion:e.target.value},function(){a.calcuPayment()})},a.onSubmit=function(){var e=a.props.dispatch,t=a.state,l=t.currentProduct,n=t.qty,r=t.capacityExpansion;l||v.default.error("\u8bf7\u9009\u62e9\u5546\u54c1"),Y({okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u8ba2\u8d2d".concat(l.name,"?"),onOk:function(){e({type:"platformproduct/toOrder",payload:{product:l.id,qty:n,capacityExpansion:r}})}})},a.calcuPayment=function(){var e=a.state,t=e.currentProduct,l=e.qty,n=e.capacityExpansion;if(t){var r=a.props,d=r.tenantInfo,o=r.prevProduct,c=(0,M.default)(d.endDate).diff((0,M.default)().format("YYYY-MM-DD"),"days")+1;if(1===n){var u=o?o.price*l/365*c:0,i=t?t.price*l/365*c-u:0;i=i>0?i:0,a.setState({transactionPrice:i,payment:i})}else{var p=0;if(d.deliveryCapacity<t.capacity&&c>0&&o){var f=o?o.price*l/365*c:0;p=t.price*l/365*c-f,p=p>0?p:0}a.setState({transactionPrice:p+t.price*l,payment:p})}}},a}return(0,b.default)(t,e),(0,g.default)(t,[{key:"componentDidMount",value:function(){var e=this.props.currentUser,t=e&&e.entCode&&4===e.entCode.length;t&&(this.loadTenant(),this.loadProduct());var a=this.state.pageSize,l=this.props.dispatch;l({type:"platformproduct/page",payload:{pageIndex:0,pageSize:a}})}},{key:"render",value:function(){var e,t,a,l,n=this,v=this.props,y=v.pageData,g=v.loading,E=v.submitting,h=v.currentUser,b=v.tenantInfo,C=v.prevProduct,P=this.state,S=P.currentProduct,k=P.capacityExpansion,I=P.transactionPrice,T=P.payment,w={};y&&(w=y);var q=h&&h.entCode&&h.entCode.length<=4,M=h&&h.entCode&&4===h.entCode.length,D=h&&h.entCode&&h.entCode.length<4,R=(null===(e=w)||void 0===e?void 0:null===(t=e.pagination)||void 0===t?void 0:t.total)>12&&(0,x.default)({},w.pagination,{onChange:function(e){n.handleStandardTableChange(e)}});return F.default.createElement(O.default,null,q?F.default.createElement(d.default,null,F.default.createElement(o.default,{defaultActiveKey:"1",style:{minHeight:"380px",paddingTop:"10px"}},F.default.createElement(o.default.TabPane,{tab:"\u670d\u52a1\u5546\u54c1",key:"1"},F.default.createElement(f.default,{loading:g,grid:{gutter:16,column:4},dataSource:w.list,pagination:R,renderItem:function(e){return F.default.createElement(f.default.Item,{onClick:function(){return n.toOrder(e)},key:e.title,style:{border:"1px solid #E8E8E8",borderRadius:8,backgroundColor:(null===S||void 0===S?void 0:S.id)===e.id?"#F7F3DE":"#E7FAFF",boxShadow:"6px 6px 3px #888888",padding:15,width:160,height:D?120:100}},F.default.createElement(f.default.Item.Meta,{avatar:F.default.createElement(s.default,{style:{backgroundColor:"#87d068"},icon:F.default.createElement(m.default,{type:"hdd",theme:"filled"})}),title:"\u51fa\u5e93\u5bb9\u91cf",description:F.default.createElement("span",{style:{color:"green",fontSize:14,fontWeight:"bold"}},(e.capacity/1e4).toFixed(0),"\u4e07/",e.unitTxt)}),F.default.createElement("span",{style:{color:"red"}},"\u5355\u4ef7\uff1a","\xa5 ".concat((0,z.default)(e.price).format("0,0.00"))),D&&F.default.createElement("p",null,F.default.createElement("span",{style:{color:"blue"}},"\u8ba1\u8d39\uff1a",e.version,"\u7248")))}}),M&&F.default.createElement("div",{style:{background:"#FFF0F0",boxShadow:"6px 6px 3px #888888",padding:20}},F.default.createElement(p.default,{size:"small",column:4},F.default.createElement(p.default.Item,{label:"\u5f53\u524d\u5bb9\u91cf"},F.default.createElement("span",{style:{color:"red"}},(null===b||void 0===b?void 0:b.deliveryCapacity)?"".concat((b.deliveryCapacity/1e4).toFixed(0),"\u4e07/\u5e74"):"--")),F.default.createElement(p.default.Item,{label:"\u5f53\u524d\u5269\u4f59"},null!==(a=null===b||void 0===b?void 0:b.leftDelivery)&&void 0!==a?a:"--"),F.default.createElement(p.default.Item,{label:"\u5f53\u524d\u670d\u52a1"},null!==(l=null===b||void 0===b?void 0:b.date)&&void 0!==l?l:"--")),F.default.createElement(p.default,{size:"small",column:4},F.default.createElement(p.default.Item,{label:"\u9009\u8d2d\u5bb9\u91cf"},F.default.createElement("span",{style:{color:"red"}},(null===S||void 0===S?void 0:S.capacity)?"".concat((S.capacity/1e4).toFixed(0),"\u4e07/").concat(S.unitTxt):"--")),F.default.createElement(p.default.Item,{label:""},F.default.createElement(u.default.Group,{value:k,onChange:this.onCapacityExpansionChange},F.default.createElement(u.default,{value:0},F.default.createElement("span",null,"\u7eed\u8d39\xa0",F.default.createElement(i.default,{title:"\u5ef6\u957f\u670d\u52a1\u671f\uff0c\u9009\u62e9\u5927\u4e8e\u73b0\u6709\u5bb9\u91cf\u4e14\u8fd8\u5728\u670d\u52a1\u671f\u5219\u9700\u8981\u8865\u7f34\u6269\u5bb9\u8d39\u7528"},F.default.createElement(m.default,{type:"question-circle-o"})))),C&&F.default.createElement(u.default,{value:1},F.default.createElement("span",null,"\u6269\u5bb9\xa0",F.default.createElement(i.default,{title:"\u589e\u52a0\u51fa\u5e93\u5bb9\u91cf\uff0c\u9700\u8865\u7f34\u6269\u5bb9\u8d39\u7528"},F.default.createElement(m.default,{type:"question-circle-o"})))))),F.default.createElement(p.default.Item,{label:"\u8d39\u7528"},F.default.createElement("span",{style:{color:"red"}},"\uffe5".concat((0,z.default)(I).format("0,0.00"))),F.default.createElement("span",{style:{color:"green"}},T>0?"\uff08\u8865\u7f34\uff1a\uffe5".concat((0,z.default)(T).format("0,0.00"),"\uff09"):"")),F.default.createElement(p.default.Item,{label:""},F.default.createElement(c.default,{type:"primary",style:{marginRight:30,marginLeft:30},disabled:!S,loading:E,onClick:this.onSubmit},"\u7acb\u5373\u8d2d\u4e70"))))))):F.default.createElement(r.default,{status:"403",title:"403",subTitle:"\u62b1\u6b49\uff0c\u975e\u5361\u5546\u7ba1\u7406\u5458\uff0c\u4f60\u65e0\u6743\u8bbf\u95ee\u8be5\u9875\u9762"}))}}]),t}(F.PureComponent),I=T))||I)||I)||I)||I),J=Z;t.default=J}}]);