(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[165],{CJl3:function(e,t,n){"use strict";var a=n("TqRt"),r=n("284h");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("J+/v");var l=a(n("MoRW"));n("14J3");var s=a(n("BMrR"));n("jCWc");var o=a(n("kPKH"));n("+L6B");var i=a(n("2/Rp"));n("+BJd");var d=a(n("mr32"));n("miYZ");var c=a(n("tsqr")),u=a(n("lwsE")),p=a(n("W8MJ")),f=a(n("a1gu")),m=a(n("Nsbk")),h=a(n("7W2i")),v=a(n("PJYZ")),g=a(n("MVZn"));n("y8nQ");var y=a(n("Vl3Y"));n("2qtc");var S,E,w,R,k=a(n("kLXV")),C=r(n("q1tI")),b=a(n("KLZ9")),x=a(n("HZnN")),N=n("MuoO"),I=a(n("ufQ4")),K=k.default.confirm,z=(S=y.default.create(),E=(0,N.connect)(function(e){var t=e.user,n=e.apipermission,a=e.loading;return(0,g.default)({currentUser:t.currentUser},n,{loading:a.effects["apipermission/get"]})}),w=x.default.Secured("/helpservice/apipermission"),(0,I.default)(R=S(R=E(R=w(R=function(e){function t(e){var n;return(0,u.default)(this,t),n=(0,f.default)(this,(0,m.default)(t).call(this,e)),n.columns=[{title:"\u5e8f\u53f7",render:function(e,t,a){var r=n.state,l=r.pageIndex,s=r.pageSize;return l*s+a+1}},{title:"\u6743\u9650",dataIndex:"name"},{title:"\u6388\u6743\u72b6\u6001",dataIndex:"state",render:function(e){return C.default.createElement("span",{style:{fontSize:18,color:1===e?"green":"red"}},1===e?"\u221a":"\xd7")}},{title:"\u9891\u7387",dataIndex:"accessLimit",render:function(e,t){return"".concat(t.limitSeconds,"\u79d2\u5185\u5141\u8bb8\u8bbf\u95ee").concat(e,"\u6b21")}}],n.loadData=function(e){var t=n.props.dispatch;t({type:"apipermission/get",payload:e})},n.onSelect=function(e,t){t&&t.selectedNodes&&t.selectedNodes.length>0&&(n.setState({selectEnterpriseName:t.selectedNodes[0].props.title,selectedRowKeys:[],selectedRows:[]}),n.loadAccount(t.selectedNodes[0].props.dataRef.id))},n.loadAccount=function(e){var t=n.props,a=t.dispatch,r=t.currentUser;a({type:"apipermission/clearPermissionOptions"}),n.setState({enterprise:e||r.enterprise}),a({type:"apipermission/get",payload:e||r.enterprise}),a({type:"apipermission/getToken",payload:e||r.enterprise})},n.handleSet=function(e){var t=(0,v.default)((0,v.default)(n)),a=n.state.selectedRows;if(0!==a.length){var r=a.map(function(e){return e.value}),l=n.state,s=l.enterprise,o=l.selectEnterpriseName,i={add:e,enterprise:s,permission:r};K({okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u7ed9\u3010".concat(o,"\u3011").concat(e?"\u6dfb\u52a0\u6743\u9650":"\u5220\u9664\u6743\u9650","?"),onOk:function(){var e=t.props.dispatch;e({type:"apipermission/post",payload:i}).then(function(){t.setState({selectedRowKeys:[],selectedRows:[]}),t.loadData(s)})}})}else c.default.warning("\u8bf7\u5148\u52fe\u9009\u5217\u8868\u6570\u636e!")},n.toCopy=function(){var e=n.props.token,t=e;t||(t="");var a=document.createElement("textarea");a.value="".concat(t),a.setAttribute("readonly",""),a.style={position:"absolute",left:"-9999px"},document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),c.default.info("\u5df2\u7ecf\u6210\u529f\u590d\u5236")},n.handleStandardTableChange=function(e,t,a){var r=n.props.currentUser,l=n.state.enterprise,s=function(e){return Object.keys(e).map(function(t){return e[t]}).join(",")},o=Object.keys(t).reduce(function(e,n){var a=(0,g.default)({},e);return a[n]=s(t[n]),a},{});n.setState({pageSize:e.pageSize});var i=(0,g.default)({enterprise:l||r.enterprise},o);a.field&&(i.sorter="".concat(a.field,"_").concat(a.order)),n.loadData(i)},n.handleSelectRows=function(e,t){n.setState({selectedRows:e,selectedRowKeys:t})},n.state={selectedRows:[],pageSize:100,selectEnterpriseName:void 0,enterprise:void 0,pageIndex:0,selectedRowKeys:[]},n}return(0,h.default)(t,e),(0,p.default)(t,[{key:"componentDidMount",value:function(){var e=this.props.currentUser;this.setState({enterprise:e.enterprise,selectEnterpriseName:e.enterpriseName}),this.loadAccount(e.enterprise)}},{key:"renderSimpleForm",value:function(){var e=this,t=this.state,n=t.selectEnterpriseName,a=t.enterprise,r=this.props,l=r.loading,c=r.token;return C.default.createElement("div",{style:{marginLeft:10,paddingBottom:10}},C.default.createElement(y.default,{layout:"inline"},C.default.createElement(s.default,{gutter:{md:16,lg:24,xl:48}},C.default.createElement(o.default,{md:8,sm:8},C.default.createElement(d.default,{color:"magenta"},"\u76ee\u6807\u5ba2\u6237\uff1a ",n),C.default.createElement(i.default,{icon:"reload",size:"small",title:"\u91cd\u65b0\u52a0\u8f7d",loading:l,shape:"circle",onClick:function(){return e.loadData(a)}})),C.default.createElement(o.default,{md:8,sm:16},C.default.createElement(i.default,{onClick:function(){return e.handleSet(!0)},icon:"plus",type:"primary"},"\u6dfb\u52a0\u6743\u9650"),C.default.createElement(i.default,{onClick:function(){return e.handleSet(!1)},style:{marginLeft:8},icon:"delete"},"\u5220\u9664\u6743\u9650"))),C.default.createElement(s.default,{gutter:{md:16,lg:24,xl:48}},C.default.createElement(o.default,{md:8,sm:24},C.default.createElement("li",null,C.default.createElement("h6",{style:{marginRight:8,display:"inline",fontWeight:"bolder"}},"\u76ee\u6807\u5ba2\u6237API\u63a5\u53e3Token:"),C.default.createElement(d.default,{color:"magenta"},c),C.default.createElement(i.default,{type:"danger",size:"small",ghost:!0,onClick:this.toCopy},"\u590d\u5236"))))))}},{key:"render",value:function(){var e=this.props,t=e.loading,n=e.currentUser,a=e.permissionOptions,r=this.state,s=r.selectedRows,o=r.selectedRowKeys,i={onSelect:this.onSelect,defaultSelectedKeys:[n.entCode]},d=n&&n.entCode&&n.entCode.length<=4,c={selectedRows:s,columns:this.columns,data:a,onChange:this.handleStandardTableChange,loading:t,onSelectRow:this.handleSelectRows,size:"small",checkBox:!0,selectedRowKeys:o};return C.default.createElement("div",null,d?C.default.createElement("div",null,C.default.createElement(b.default,{entpriseInit:i,SearchForm:this.renderSimpleForm(),tableInit:c})):C.default.createElement(l.default,{status:"403",title:"403",subTitle:"\u62b1\u6b49\uff0c\u975e\u5361\u5546\u7ba1\u7406\u5458\uff0c\u4f60\u65e0\u6743\u8bbf\u95ee\u8be5\u9875\u9762"}))}}]),t}(C.Component))||R)||R)||R)||R),J=z;t.default=J}}]);