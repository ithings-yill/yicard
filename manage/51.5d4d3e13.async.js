(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[51],{S8IL:function(e,t,a){"use strict";var n=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var l=n(a("bx4M"));a("5Dmo");var r=n(a("3S7+"));a("/zsF");var u=n(a("PArb"));a("+BJd");var o=n(a("mr32"));a("qVdP");var d=n(a("jsC+"));a("lUTK");var c=n(a("BvKs")),f=n(a("jehZ"));a("Pwec");var i=n(a("CtXQ")),s=n(a("WweU")),p=n(a("gWZ8"));a("14J3");var m=n(a("BMrR"));a("+L6B");var h=n(a("2/Rp"));a("jCWc");var g=n(a("kPKH"));a("5NDa");var y=n(a("5rEg"));a("2qtc");var v=n(a("kLXV")),E=n(a("2Taf")),k=n(a("vZ4D")),S=n(a("MhPg")),C=n(a("l4Ni")),w=n(a("ujKo"));a("y8nQ");var x=n(a("Vl3Y"));a("ozfa");var M,b,K,P,I=n(a("MJZm")),R=L(a("q1tI")),D=n(a("KLZ9")),A=n(a("ufQ4")),O=n(a("wd/R")),T=n(a("HZnN")),N=n(a("3a4m")),F=a("MuoO"),j=n(a("xTVP"));function z(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(z=function(e){return e?a:t})(e)}function L(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var a=z(t);if(a&&a.has(e))return a.get(e);var n={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var u=l?Object.getOwnPropertyDescriptor(e,r):null;u&&(u.get||u.set)?Object.defineProperty(n,r,u):n[r]=e[r]}return n.default=e,a&&a.set(e,n),n}function B(e){var t=V();return function(){var a,n=(0,w.default)(e);if(t){var l=(0,w.default)(this).constructor;a=Reflect.construct(n,arguments,l)}else a=n.apply(this,arguments);return(0,C.default)(this,a)}}function V(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var W=I.default.TreeNode,U=x.default.Item,Z=(M=x.default.create(),b=(0,F.connect)(function(e){var t=e.roleManager,a=e.loading;return{roleAuths:t.roleAuths,roleAuthsLoading:a.effects["roleManager/getAuthById"],currentAuthsLoading:a.effects["roleManager/getcurrentauths"],treeData:t.treeData.tree,tableData:t.data,loading:a.effects["roleManager/getPage"],putLoading:a.effects["roleManager/put"]}}),K=T.default.Secured("/baseManager/roleManager"),(0,A.default)(P=M(P=b(P=K(P=function(e){(0,S.default)(a,e);var t=B(a);function a(e){var n;return(0,E.default)(this,a),n=t.call(this,e),n.handleFormCreate=function(){N.default.push("/baseManager/roleManager/create")},n.handleUpdate=function(e,t){N.default.push("/baseManager/roleManager/edit/".concat(t.id))},n.handleDel=function(e,t){v.default.confirm({title:"\u5220\u9664\u89d2\u8272",content:"\u5c5e\u4e8e\u8be5\u89d2\u8272\u7684\u7528\u6237\u4e5f\u4f1a\u88ab\u5220\u9664\uff0c\u786e\u5b9a\u5220\u9664[".concat(t.name,"]\u5417\uff1f"),okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",onOk:function(){var e=n.state,a=e.selectEntKey,l=e.pageIndex,r=n.props.tableData,u=n.defalutParams(a),o=l;1===r.list.length&&o>=1&&(u.page=o-1);var d=n.props.dispatch;d({type:"roleManager/delete",payload:{record:t,pageArgs:u}})}})},n.handleAuth=function(e){n.setState({activeIndex:e.id},function(){var t=n.props.dispatch;t({type:"roleManager/getAuthById",payload:e.id}).then(function(){var e=n.props.roleAuths.tree;n.setState({checkKeys:e})})})},n.handleStandardTableChange=function(e){var t=n.state.selectEntKey,a=n.defalutParams(t);n.setState({pageIndex:e.current-1,pageSize:e.pageSize},function(){a.pageSize=e.pageSize,a.page=e.current-1;var t=n.props.dispatch;t({type:"roleManager/getPage",payload:a})})},n.handleSelectRows=function(e){n.setState({selectedRows:e})},n.onSelect=function(e){if(0!==e.length){n.setState({selectEntKey:e});var t=n.defalutParams(e),a=n.props.dispatch;a({type:"roleManager/getPage",payload:t})}},n.handleSearch=function(e){e.preventDefault();var t=n.props,a=t.dispatch,l=t.form;l.validateFields(function(e,t){e||n.setState({formValues:t},function(){var e=n.defalutParams();a({type:"roleManager/getPage",payload:e})})})},n.handleFormReset=function(){var e=n.props,t=e.form,a=e.dispatch;t.resetFields(),n.setState({formValues:{}},function(){var e=n.defalutParams();a({type:"roleManager/getPage",payload:e})})},n.handleMenuClick=function(){},n.renderSearchForm=function(){var e=n.props.form.getFieldDecorator;return R.default.createElement(x.default,{layout:"inline",onSubmit:n.handleSearch},R.default.createElement(m.default,{gutter:{md:8,lg:24,xl:48},style:{marginBottom:10}},R.default.createElement(g.default,{md:12,sm:24},R.default.createElement(U,{label:"\u89d2\u8272\u540d"},e("name")(R.default.createElement(y.default,{placeholder:"\u8bf7\u8f93\u5165"})))),R.default.createElement(g.default,{md:12,sm:24},R.default.createElement("span",{className:j.default.submitButtons},R.default.createElement(h.default,{type:"primary",htmlType:"submit",icon:"search"},"\u67e5\u8be2"),R.default.createElement(h.default,{style:{marginLeft:8},onClick:n.handleFormReset},"\u91cd\u7f6e")))))},n.savaAuths=function(){var e=n.props,t=e.roleAuths,a=e.dispatch,l=n.state.checkKeys,r=function(e){return l.filter(function(t){return t.key.indexOf(e)>-1}).map(function(e){var t=e.key.lastIndexOf("-")+1;return e.key.substr(t,e.key.length-t)})};t.menu=r("m-").join(),t.linkAuth=r("l-").join(),t.optAuth=r("o-").join(),a({type:"roleManager/put",payload:t})},n.treeChecked=function(e,t){var a=n.props.treeData,l=n.state.checkKeys,r=[];if(t.checked){var u=function e(t,a){var n=t.filter(function(e){return e.key===a});if(n.length>0)for(var l=0;l<n.length;l+=1)r.push(n[l]),e(t,n[l].pid)},o=e.checked[e.checked.length-1];u(a,o);var d=new Map;[].concat(r,(0,p.default)(l)).forEach(function(e){d.set(e.key,e)}),n.setState({checkKeys:Array.from(d.values())})}else{var c=e.checked,f=l.filter(function(e){return-1===c.indexOf(e.key)})[0];r.push(f);var i=function e(t,a){var n=t.filter(function(e){return e.pid===a});if(n.length>0)for(var l=0;l<n.length;l+=1)r.push(n[l]),e(t,n[l].key)};i(l,f.key);for(var s=function(e){var t=l.findIndex(function(t){return t.key===r[e].key});l.splice(t,1)},m=0;m<r.length;m+=1)s(m);n.setState({checkKeys:l})}},n.allChecked=function(){var e=n.props.treeData,t=(0,s.default)(e),a=t.slice(0);n.setState({checkKeys:a})},n.noAllChecked=function(){n.setState({checkKeys:[]})},n.allExpand=function(){var e=n.props.treeData,t=e.map(function(e){return e.key});n.setState({defaultExpandedKeys:t})},n.allColse=function(){n.setState({defaultExpandedKeys:[]})},n.onExpand=function(e){n.setState({defaultExpandedKeys:e})},n.renderTreeNodes=function(e,t){for(var a=[],l=0;l<e.length;l+=1){var r=e[l];if(r.pid===t){var u=R.default.createElement(W,(0,f.default)({},r,{icon:R.default.createElement(i.default,{type:r.iconId,theme:"twoTone"})}),n.renderTreeNodes(e,r.key));a.push(u)}}return a},n.renderOperator=function(){var e=n.state.selectedRows,t=n.props.location.pathname,a=R.default.createElement(c.default,{onClick:n.handleMenuClick,selectedKeys:[]},R.default.createElement(c.default.Item,{key:"remove"},"\u5220\u9664"),R.default.createElement(c.default.Item,{key:"approval"},"\u6279\u91cf\u5ba1\u6279"));return R.default.createElement(R.Fragment,null,R.default.createElement(T.default,{authority:[t,"add"]},R.default.createElement(h.default,{icon:"plus",type:"primary",onClick:n.handleFormCreate},"\u65b0\u5efa")),e.length>0&&R.default.createElement("span",null,R.default.createElement(h.default,null,"\u6279\u91cf\u64cd\u4f5c"),R.default.createElement(d.default,{overlay:a},R.default.createElement(h.default,null,"\u66f4\u591a\u64cd\u4f5c ",R.default.createElement(i.default,{type:"down"})))))},n.rowClassName=function(e){var t=n.state.activeIndex;return e.id===t?"".concat(j.default["l-table-row-active"]):""},n.state={selectEntKey:[],selectedRows:[],formValues:{},pageSize:10,pageIndex:0,activeIndex:-1,checkKeys:[],defaultExpandedKeys:[]},n}return(0,k.default)(a,[{key:"componentDidMount",value:function(){var e=this.props.dispatch;e({type:"roleManager/getcurrentauths"})}},{key:"componentWillUnmount",value:function(){var e=this.props.dispatch;e({type:"roleManager/setcurrentauths",payload:{}}),e({type:"roleManager/setData",payload:{list:[],pagination:{}}})}},{key:"defalutParams",value:function(e){var t=this.state,a=t.formValues,n=t.pageSize,l=t.selectEntKey,r={entCode:e?e[0]:l[0],roleName:a.name,entName:a.entName,pageSize:n,page:0};return r}},{key:"render",value:function(){var e=this,t=this.props,a=t.tableData,n=t.loading,d=t.currentUser,c=t.roleAuthsLoading,f=t.treeData,s=t.putLoading,p=t.currentAuthsLoading,y=this.state,v=y.checkKeys,E=y.defaultExpandedKeys,k=y.activeIndex,S=y.selectedRows,C={onSelect:this.onSelect,defaultSelectedKeys:[d.entCode]},w={columns:[{width:80,title:"\u5e8f\u53f7",render:function(t,a,n){var l=e.state,r=l.pageIndex,u=l.pageSize;return r*u+n+1}},{title:"\u89d2\u8272\u540d",dataIndex:"name"},{title:"\u89d2\u8272\u8303\u56f4",dataIndex:"authRangeStr",render:function(e,t){var a=t.authRange?"volcano":"geekblue",n=20;return t.authRangeStr.length>n?R.default.createElement(o.default,{color:a},"".concat(t.authRangeStr.substr(0,20),"....")," "):R.default.createElement(o.default,{color:a},t.authRangeStr," ")}},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"createTime",render:function(e){return R.default.createElement("span",null,(0,O.default)(e).format("YYYY-MM-DD HH:mm:ss"))}},{title:"\u64cd\u4f5c",render:function(t,a,n){var l=e.props.location.pathname;return R.default.createElement(R.Fragment,null,a.entCode>=d.entCode?R.default.createElement(R.Fragment,null,R.default.createElement(T.default,{authority:[l,"edit"]},R.default.createElement("a",{onClick:function(){return e.handleUpdate(!0,a)}},"\u7f16\u8f91")),R.default.createElement(T.default,{authority:[l,"delete"]},R.default.createElement(u.default,{type:"vertical"}),R.default.createElement("a",{onClick:function(t){t.stopPropagation(),t.nativeEvent.stopImmediatePropagation(),e.handleDel(!0,a)}},"\u5220\u9664")),R.default.createElement(u.default,{type:"vertical"}),R.default.createElement(T.default,{authority:[l,"edit"]},R.default.createElement("a",{onClick:function(t){t.stopPropagation(),t.nativeEvent.stopImmediatePropagation(),e.handleAuth(a,n)}},"\u6743\u9650\u5206\u914d"))):null)}}],selectedRows:S,data:a,onChange:this.handleStandardTableChange,loading:n,onSelectRow:this.handleSelectRows,rowKey:"id",rowClassName:this.rowClassName},x=function(){return R.default.createElement(R.Fragment,null,R.default.createElement(i.default,{type:"appstore",theme:"twoTone"}),"-",R.default.createElement("span",null,"\u83dc\u5355"),R.default.createElement(u.default,{type:"vertical"}),R.default.createElement(i.default,{type:"file",theme:"twoTone"}),"-",R.default.createElement("span",null,"\u9875\u9762"),R.default.createElement(u.default,{type:"vertical"}),R.default.createElement(i.default,{type:"tool",theme:"twoTone"}),"-",R.default.createElement("span",null,"\u64cd\u4f5c"))};return R.default.createElement(R.default.Fragment,null,R.default.createElement(m.default,{className:j.default.main,gutter:8},R.default.createElement(g.default,{span:18},R.default.createElement(D.default,{entpriseInit:C,tableInit:w,SearchForm:this.renderSearchForm(),Operator:this.renderOperator()})),R.default.createElement(g.default,{span:6},R.default.createElement(l.default,{title:x(),extra:k>-1?R.default.createElement(h.default,{type:"primary",onClick:this.savaAuths,loading:s},"\u4fdd\u5b58\u6743\u9650"):null,loading:c||p},R.default.createElement("div",{className:j.default.operation},R.default.createElement(r.default,{title:"\u5168\u9009"},R.default.createElement(i.default,{type:"check",className:j.default.icon,onClick:this.allChecked})),R.default.createElement(u.default,{type:"vertical"}),R.default.createElement(r.default,{title:"\u4e0d\u9009"},R.default.createElement(i.default,{type:"close",onClick:this.noAllChecked})),R.default.createElement(u.default,{type:"vertical"}),R.default.createElement(r.default,{title:"\u5168\u5c55\u5f00"},R.default.createElement(i.default,{type:"bars",onClick:this.allExpand})),R.default.createElement(u.default,{type:"vertical"}),R.default.createElement(r.default,{title:"\u6536\u7f29"},R.default.createElement(i.default,{type:"minus",onClick:this.allColse}))),f&&R.default.createElement(I.default,{onExpand:this.onExpand,expandedKeys:E,showIcon:!0,checkable:!0,checkStrictly:!0,onCheck:this.treeChecked,checkedKeys:v.map(function(e){return e.key})},this.renderTreeNodes(f,"m-0"))))))}}]),a}(R.Component))||P)||P)||P)||P),J=Z;t.default=J},xTVP:function(e,t,a){e.exports={main:"antd-pro\\pages\\-base-manager\\-role-manager\\index-main","l-table-row-active":"antd-pro\\pages\\-base-manager\\-role-manager\\index-l-table-row-active"}}}]);