(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[55],{EcrP:function(e,t,a){"use strict";var n=a("TqRt"),o=a("284h");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("14J3");var r=n(a("BMrR"));a("jCWc");var l=n(a("kPKH"));a("sRBo");var d=n(a("kaz8"));a("+L6B");var i=n(a("2/Rp")),s=n(a("pVnL"));a("miYZ");var u=n(a("tsqr")),c=n(a("lwsE")),f=n(a("W8MJ")),h=n(a("a1gu")),m=n(a("Nsbk")),p=n(a("7W2i")),g=n(a("PJYZ")),v=n(a("MVZn"));a("2qtc");var y,x,w,C,S=n(a("kLXV")),D=o(a("q1tI")),F=a("MuoO"),T=n(a("EUZL")),I=n(a("wd/R")),k=n(a("ufQ4")),E=n(a("HZnN")),M=n(a("KLZ9")),Y=n(a("wwJy")),P=n(a("j2WA")),b=n(a("TGaQ")),R="YYYYMM",z=S.default.confirm,B=[{title:"\u8fd0\u8425\u5546",dataIndex:"oTypeTxt",sorter:!0,width:130},{title:"\u9500\u552e\u5ba2\u6237",dataIndex:"sName",width:230},{title:"\u4e3b\u5957\u9910",dataIndex:"packageName",width:200},{title:"\u5361\u72b6\u6001",dataIndex:"statusTxt",sorter:!0,width:100},{title:"\u672c\u6708\u7528\u91cf(M)",dataIndex:"uFlow",sorter:!0,width:120},{title:"\u5df2\u7528\u6d41\u91cf(M)",dataIndex:"uPFlow",sorter:!0,width:120},{title:"\u53ef\u7528\u6d41\u91cf(M)",dataIndex:"tPFlow",sorter:!0,width:120},{title:"\u5df2\u7528\u77ed\u4fe1(\u6761)",dataIndex:"uPSms",sorter:!0,width:120},{title:"\u53ef\u7528\u77ed\u4fe1(\u6761)",dataIndex:"tPSms",sorter:!0,width:120},{title:"\u77ed\u4fe1\u8d39(\u5143)",dataIndex:"uSms",width:100,render:function(e,t){return.1*t.uSms}},{title:"\u5df2\u7528\u5b9a\u4f4d(\u6b21)",dataIndex:"uPLbs",sorter:!0,width:120},{title:"\u53ef\u7528\u5b9a\u4f4d(\u6b21)",dataIndex:"tPLbs",sorter:!0,width:120},{title:"\u6fc0\u6d3b\u65e5\u671f",dataIndex:"aDateTxt",sorter:!0,width:100},{title:"\u670d\u52a1\u5f00\u59cb",dataIndex:"effDateTxt",sorter:!0,width:130},{title:"\u670d\u52a1\u622a\u6b62",dataIndex:"invDateTxt",sorter:!0,width:130}],L=(y=(0,F.connect)(function(e){var t=e.user,a=e.monthmodel,n=e.loading;return(0,v.default)({},a,{currentUser:t.currentUser,loading:n.effects["monthmodel/page"],Downloading:n.effects["monthmodel/list"],loadingcardtype:n.effects["monthmodel/fetchcardtype"]})}),x=E.default.Secured("/record/monthreport"),(0,k.default)(w=y(w=x((C=function(e){function t(e){var a;return(0,c.default)(this,t),a=(0,h.default)(this,(0,m.default)(t).call(this,e)),a.scrollX=2300,a.headColumns=[{title:"\u5361\u53f7",dataIndex:"msisdn",sorter:!0,fixed:"left",width:120},{title:"ICCID",dataIndex:"iccid",sorter:!0,fixed:"left",width:170}],a.columns=[],a.doCount=function(e){var t=a.props.dispatch;t({type:"monthmodel/getstockCount",payload:{month:e}}),a.loadCost()},a.loadCost=function(e){var t,n=a.state.month,o=a.props,r=o.dispatch,l=o.currentUser;r({type:"monthmodel/getCost",payload:{month:n,entCode:null!==(t=e)&&void 0!==t?t:l.entCode}})},a.handleStandardTableChange=function(e,t,n){var o=null;if(n){var r=n.field,l=n.order;o={field:r,order:l}}var d=e.current;a.setState({pageSize:e.pageSize});var i=a.state,s=i.formValues,u=i.entCode,c=i.isAdvanced,f=(0,v.default)({segmentsQuery:c,pageIndex:d-1,pageSize:e.pageSize,entCode:u},s,{sorter:o});a.loadData(f),a.loadCost(u)},a.loadData=function(e){var t=a.props.dispatch,n=a.state.month;if(e.month){var o="".concat(e.month.format(R));o!==n&&a.doCount(o)}var r=e.month?"".concat(e.month.format(R)):n;t({type:"monthmodel/page",payload:(0,v.default)({},e,{month:r})})},a.handleSelectRows=function(e){a.setState({selectedRows:e})},a.onSelect=function(e){a.setState({entCode:e[0]});var t=a.state.pageSize,n={pageIndex:0,pageSize:t,entCode:e[0]};a.loadData(n),a.loadCost(e[0])},a.handleSearch=function(e){var t=a.state,n=t.pageSize,o=t.entCode,r=t.isAdvanced,l=(0,v.default)({segmentsQuery:r},e,{pageIndex:0,pageSize:n,entCode:o,effDateBegin:e.effDateBegin?"".concat(e.effDateBegin.format("YYYY-MM-DD")," 00:00:00"):null,effDateEnd:e.effDateEnd?"".concat(e.effDateEnd.format("YYYY-MM-DD")," 00:00:00"):null,invDateBegin:e.invDateBegin?"".concat(e.invDateBegin.format("YYYY-MM-DD")," 00:00:00"):null,invDateEnd:e.invDateEnd?"".concat(e.invDateEnd.format("YYYY-MM-DD")," 00:00:00"):null});a.setState({formValues:e,month:"".concat(e.month.format(R))}),a.loadData(l)},a.handleFormReset=function(){var e=a.state,t=e.pageSize,n=e.entCode;a.setState({formValues:{}});var o={pageIndex:0,pageSize:t,entCode:n};a.loadData(o)},a.onQueryTypeChange=function(e){a.setState({queryType:e})},a.handleExport=function(){var e=(0,g.default)((0,g.default)(a));z({okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5bfc\u51fa\u5168\u90e8?",onOk:function(){e.exportAll()}})},a.exportAll=function(){var e=a.props.dispatch,t=a.state,n=t.formValues,o=t.entCode,r=t.month,l=t.isAdvanced,d=(0,v.default)({segmentsQuery:l,entCode:o},n,{pageSize:1e6,pageIndex:0,month:r,downTask:!0});a.setState({exporting:!0}),e({type:"monthmodel/list",payload:d}).then(function(){a.setState({exporting:!1})})},a.downLoad=function(){var e=a.state.selectedRows;0!==e.length?(a.setState({exporting:!0}),a.exportToFile(e),a.setState({exporting:!1})):u.default.warning("\u8bf7\u5148\u52fe\u9009\u5217\u8868\u6570\u636e!")},a.exportToFile=function(e){var t=e.map(function(e){return{"\u5361\u53f7":e.msisdn,ICCID:e.iccid,"\u8fd0\u8425\u5546":e.oTypeTxt,"\u9500\u552e\u5ba2\u6237":e.sName,"\u4e3b\u5957\u9910":e.packageName,"\u5361\u72b6\u6001":e.statusTxt,"\u672c\u6708\u7528\u91cf":e.uFlow,"\u5df2\u7528\u6d41\u91cf":e.uPFlow,"\u53ef\u7528\u6d41\u91cf":e.tPFlow,"\u5df2\u7528\u77ed\u4fe1":e.uPSms,"\u53ef\u7528\u77ed\u4fe1":e.tPSms,"\u77ed\u4fe1\u8d39":.1*e.uPSms,"\u5df2\u7528\u5b9a\u4f4d":e.uPLbs,"\u53ef\u7528\u5b9a\u4f4d":e.tPLbs,"\u6fc0\u6d3b\u65e5\u671f":e.aDateTxt}}),a=T.default.utils.json_to_sheet(t),n=T.default.utils.book_new();T.default.utils.book_append_sheet(n,a,"cardinfo"),T.default.writeFile(n,"\u6708\u62a5\u8868".concat((0,I.default)().format("YYYY-MM-DD hh_mm"),".xlsx"))},a.toggleForm=function(){var e=a.state.isAdvanced;a.setState({isAdvanced:!e,queryType:0})},a.filterForm=function(){var e=a.state.filterFormVisible;a.setState({filterFormVisible:!e})},a.filterOk=function(){a.filterForm()},a.onFilterChange=function(e){e&&(a.columns=[],a.headColumns.map(function(e,t){return a.columns.splice(t,0,e)}),e.map(function(e,t){var n=B.find(function(t){return t.dataIndex===e});return a.columns.splice(t+2,0,n)}),a.scrollX=0,a.columns.map(function(e){return a.scrollX+=e.width}),a.scrollX<1e3&&(a.scrollX=1100))},a.getPreMonth=function(){var e=new Date;return e.setMonth(e.getMonth()-1),(0,I.default)(e).format(R)},a.state={selectedRows:[],formValues:{},pageSize:10,exporting:!1,filterFormVisible:!1,month:a.getPreMonth(),isAdvanced:!1,queryType:0},a.columns=[],a.headColumns.map(function(e,t){return a.columns.splice(t,0,e)}),B.map(function(e,t){return a.columns.splice(t+2,0,e)}),a.scrollX=0,a.columns.map(function(e){return a.scrollX+=e.width?e.width:120}),a}return(0,p.default)(t,e),(0,f.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.state.month;this.doCount(t),setTimeout(function(){e.loadCardType()},2e3);var a=this.props.currentUser,n=a&&a.entCode&&a.entCode.length<=4;n&&setTimeout(function(){e.loadOperator()},1e3)}},{key:"loadCardType",value:function(){var e=this.props.dispatch;e({type:"monthmodel/fetchcardtype"})}},{key:"loadOperator",value:function(){var e=this.props.dispatch;e({type:"monthmodel/queryOperator"})}},{key:"renderSimpleForm",value:function(){return D.default.createElement(P.default,(0,s.default)({},this.props,{monthDate:(0,I.default)(this.getPreMonth(),R),handleFormReset:this.handleFormReset,handleSearch:this.handleSearch,toggleForm:this.toggleForm}))}},{key:"renderAdvancedForm",value:function(){var e=this.state,t=e.uBegin,a=e.uEnd,n=e.queryType,o=e.invDateBegin,r=e.invDateEnd,l=e.oType;return D.default.createElement(Y.default,(0,s.default)({},this.props,{monthDate:(0,I.default)(this.getPreMonth(),R),oType:l,queryType:n,uBegin:t,uEnd:a,invDateBegin:o,invDateEnd:r,handleFormReset:this.handleFormReset,handleSearch:this.handleSearch,toggleForm:this.toggleForm,onQueryTypeChange:this.onQueryTypeChange}))}},{key:"renderOperator",value:function(){var e=this.state.exporting;return D.default.createElement(D.Fragment,null,D.default.createElement("span",null,D.default.createElement(i.default,{onClick:this.downLoad,icon:"download"},"\u5bfc\u51fa[\u9009\u4e2d]"),D.default.createElement(i.default,{style:{marginLeft:8},type:"primary",icon:"file-excel",loading:e,onClick:this.handleExport},"\u5bfc\u51fa\u5168\u90e8"),D.default.createElement(i.default,{style:{marginLeft:8},onClick:this.filterForm,icon:"filter"},"\u6570\u636e\u5217\u7b5b\u9009")))}},{key:"render",value:function(){var e=this.props,t=e.pageData,a=e.loading,n=e.currentUser,o=e.statisticsTotal,i=this.state,s=i.selectedRows,u=i.isAdvanced,c=i.filterFormVisible,f={onSelect:this.onSelect,defaultSelectedKeys:[n.entCode],limit:8,statisticsTotal:o,property:["inStock"],propertyColor:"#F65327",treeHeight:b.default.treeHeight},h={columns:this.columns,selectedRows:s,onChange:this.handleStandardTableChange,loading:a,onSelectRow:this.handleSelectRows,checkBox:!0,scroll:{x:this.scrollX},size:"small"};h.data=t;var m=u?this.renderAdvancedForm():this.renderSimpleForm();return D.default.createElement(D.default.Fragment,null,D.default.createElement(M.default,{entpriseInit:f,tableInit:h,SearchForm:m,Operator:this.renderOperator()}),D.default.createElement(S.default,{destroyOnClose:!0,title:"\u6570\u636e\u5217\u8fc7\u6ee4",visible:c,onOk:this.filterOk,onCancel:this.filterForm},D.default.createElement(d.default.Group,{style:{width:"100%"},defaultValue:this.columns.map(function(e){return e.dataIndex}),onChange:this.onFilterChange},D.default.createElement(r.default,null,B.map(function(e){return D.default.createElement(l.default,{key:e.dataIndex,span:8},D.default.createElement(d.default,{value:e.dataIndex},e.title))})))))}}]),t}(D.Component),w=C))||w)||w)||w),O=L;t.default=O}}]);